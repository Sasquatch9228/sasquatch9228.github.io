<!DOCTYPE html>
<html>
    <head>
        <title>CryptoSmite Unenrollment Exploit - Chrome OS Exploits</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="../../assets/icon.png">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans">
        <link rel="stylesheet" href="../../main.css">
        <link rel="stylesheet" href="../detail.css">
        <script src="../addheader.js"></script>
        <script>
            window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
            ga('create', 'UA-XXXXX-Y', 'auto');
            ga('send', 'pageview');
        </script>
    <meta name="google-site-verification" content="weY0_IfasLpB3jj53TSPZIfHSBY2obh-2hIuFTVIrhw" /></head>
    <body>
        <div id="main-content">
        <h3>
            <span class="title">CryptoSmite Unenrollment Exploit</span>
            <br>
            <small>FWSmasher, unretained, fallenmoon8080, Catakang#0987</small>
            <p>
            <a href="https://docs.google.com/presentation/d/1MciRMbDEb3RJomH2gYW9C5qRVjS4P92o2s4QepoCSgY" target="_blank">
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-link flex-shrink-0 mr-2">
                    <path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path>
                </svg>
                Website
            </a>
            <a href="https://exploitingchromium.blogspot.com" target="_blank">
                <svg aria-hidden="true" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 256 256" enable-background="new 0 0 256 256" xml:space="preserve">
                    <path fill="#000000" d="M185.4,246h-129C31.7,246,10,224.3,10,199.6V56.4C10,31.7,31.7,10,56.4,10h143.2c24.7,0,46.4,21.7,46.4,46.4v129L185.4,246z M56.4,26.9c-14.8,0-29.5,14.8-29.5,29.5v143.2c0,14.8,14.8,29.5,29.5,29.5H178l51.2-51.2V56.4c0-14.8-14.7-29.5-29.5-29.5H56.4z"/><path fill="#000000" d="M176.2,177.8h65.9l-65.9,64V177.8z"/><path fill="#000000" d="M190.6,111.1H65.4c-4.9,0-9-3.5-9-8.4c0-4.9,4-8.4,9-8.4h125.3c5,0,9,3.5,9,8.4C199.6,107.7,195.6,111.1,190.6,111.1z"/><path fill="#000000" d="M172.7,144.9H65.4c-4.9,0-9-3.5-9-8.4c0-4.9,4-8.4,9-8.4h107.4c5,0,9,3.5,9,8.4C181.7,141.4,177.7,144.9,172.7,144.9z"/><path fill="#000000" d="M218.6,209.7c-0.2,0.4-0.6,0.4-1,0.3"/>
                </svg>
                Blog
            </a>
            <a href="https://github.com/FWSmasher/CryptoSmite" target="_blank">
                <svg width="16" viewBox="0 0 16 16">
                    <path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"></path>
                </svg>
                GitHub
            </a>
            <a href="https://discord.com/channels/419123358698045453/1216077007419609149" target="_blank">
                <svg style="color: rgb(0, 0, 0);" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-discord" viewBox="0 0 16 16">
                    <path d="M13.545 2.907a13.227 13.227 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.19 12.19 0 0 0-3.658 0 8.258 8.258 0 0 0-.412-.833.051.051 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041 0 0 0-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276 0 0 0 3.995 2.02.05.05 0 0 0 .056-.019c.308-.42.582-.863.818-1.329a.05.05 0 0 0-.01-.059.051.051 0 0 0-.018-.011 8.875 8.875 0 0 1-1.248-.595.05.05 0 0 1-.02-.066.051.051 0 0 1 .015-.019c.084-.063.168-.129.248-.195a.05.05 0 0 1 .051-.007c2.619 1.196 5.454 1.196 8.041 0a.052.052 0 0 1 .053.007c.08.066.164.132.248.195a.051.051 0 0 1-.004.085 8.254 8.254 0 0 1-1.249.594.05.05 0 0 0-.03.03.052.052 0 0 0 .003.041c.24.465.515.909.817 1.329a.05.05 0 0 0 .056.019 13.235 13.235 0 0 0 4.001-2.02.049.049 0 0 0 .021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034 0 0 0-.02-.019Zm-8.198 7.307c-.789 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.45.73 1.438 1.613 0 .888-.637 1.612-1.438 1.612Zm5.316 0c-.788 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.451.73 1.438 1.613 0 .888-.631 1.612-1.438 1.612Z" fill="#000000"></path>
                </svg>
                Discord
            </a>
            <a href="https://raw.githubusercontent.com/FWSmasher/CryptoSmite/main/cryptosmite.sh" target="_blank">
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-code UnderlineNav-octicon d-none d-sm-inline">
                    <path d="m11.28 3.22 4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L13.94 8l-3.72-3.72a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215Zm-6.56 0a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L2.06 8l3.72 3.72a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L.47 8.53a.75.75 0 0 1 0-1.06Z"></path>
                </svg>
                Source
            </a>
        </h3>
        <p>
        <div class="note">The kernel version of your Chromebook must end with a <strong>0</strong>, <strong>1</strong>, or <strong>2</strong> to perform this exploit.</div>
        <p>
        An unenrollment exploit that uses stateful files to unenroll.
        <h3>How it works</h3>
        Uses stateful backups that allow changing the encrypted contents of the stateful partition to arbritary contents. This data is useful for enrollment status, so it was changed to make the device appear unenrolled. On the OOBE, it starts the AutoEnrollmentController, which chains into the ash ownership system, and then the ownership system checks for a file. If this file exists, it removes firmware management parameters (FWMP).
        <h3>Performing the exploit</h3>
        <b>NOTICE:</b> The authors are not responsible for any damage caused by the use of this exploit. Do not contact them for any issues it causes to your device.
        <ol>
            <h3>Instructions</h3>
            <li><a href="https://support.google.com/chromebook/answer/1080595#:~:text=Enter%20recovery%20mode" target="_blank">Enter into Recovery Mode</a> by holding ESC + Refresh + Power for 2 or 3 seconds. You should be on an "Insert Recovery Media" or "Let's step you through the recovery process" screen.</li>
            <li>Check your kernel version for compatibility by pressing TAB and looking at the last digit of the <code>kernver=</code> line. If the last number of the <code>kernver=</code> line is a <strong>0</strong>, <strong>1</strong>, or <strong>2</strong>, your Chromebook is supported and you can downgrade to ChromeOS version 119 or lower. Follow the instructions at the <a href='/detail/downgrade/' target='_blank'>Downgrade Versions</a> section.</li> If the last number of the <code>kernver=</code> line is a <strong>3</strong>, your Chromebook is not supported, and you cannot downgrade to ChromeOS version 119 or lower. Wait for a new unrenrollment exploit or do a <a href='/detail/Pencil%20Method/' target='_blank'>dangerous hardware modification</a> here.</li>
            <li>On a personal device, download <a href="assets/stateful2.tar.xz" download>stateful.tar.xz</a>, and the Cryptsetup chroot <a href="assets/st.tar.xz" download>st.tar.xz</a>. For raw RMA shims, check the <a href="https://discord.com/channels/1060740596479828079/1142158735897272382" target="_blank">SH1MMER discord server</a>. Keep all of these downloads ready before starting.</li>
            <li>In the Linux terminal (or WSL) run the following command: <code>git clone https://github.com/FWSmasher/CryptoCrafter</code>.</li>
            <li>Afterwards, run this command in your Linux terminal (WSL or real Linux or a virtual machine). <strong>IT MUST BE IN THE CLONED DIRECTORY</strong>: <code>./cryptosmite_host.sh <raw rma shim path> <cryptsetup chroot path> <stateful.tar.xz path></code>.</li>
            <details>
                <summary><u>Prepare the new RMA shim for flashing</u></summary>
                <li>Open the <a href="https://chrome.google.com/webstore/detail/pocpnlppkickgojjlmhdmidojbmbodfm">Chromebook Recovery Utility extension</a>, and in the top right corner select "<strong>Use local image</strong>." The image should be the modified RMA shim. </li>
                <li>Select the USB drive to flash.</li>
            </details>
            <details>
                <summary><u>Boot the RMA shim</u></summary>
                <li>You will first need to enter recovery mode by pressing ESC + Refresh + Power.</li>
                <li>After entering recovery mode, enable developer mode by pressing Ctrl + D on the recovery mode screen.</li>
                <li>Developer mode will be blocked by policy as shown in the top left corner of the screen.</li>
                <li>Press ESC + Refresh + Power Button again, and then plug in the USB drive you have just flashed.</li>
            </details>
            <details>
                <summary><u>Running the injected CryptoSmite file</u></summary>
                <li>Run <code>cryptosmite.sh</code> in the injected RMA shim.</li>
                <li>In the bash shell prompt in the edit stateful bash shell screen, run this command: <code>tar -xvf /mnt/shim_stateful/stateful.tar.xz -C /mnt/stateful exit</code>.</li>
                <li>The system will now reboot into verified mode.</li>
                <li>You should now press the OK button at the OOBE screen or add user screen.</li>
                <li>Once you reach the add user screen, enable developer mode. If you do not reach the add user screen or if it gets stuck, make an issue on the <a href="https://github.com/FWSmasher/CryptoSmite" target="_blank">GitHub repository</a>.</li>
            </details>
            <p>
            To enable developer mode, press ESC + Refresh + Power Button to enter recovery mode, and then press Ctrl + D to enable developer mode.
            <p>
            From here, there are two ways to proceed. You could stick around for the five-minute wait by pressing Ctrl + D, or skip the developer mode transition.
            <p>
            <details>
                <summary><u>How to skip the 5 minute developer mode wait and transition</u></summary>
                <li>Once you have reached the "<strong>developer mode is on</strong>" screen, press ESC + Refresh + Power and boot into an RMA shim.</li>
                <li>Select the bash shell, and run the following commands (or add it as a bash script): <code>mkfs.ext4 /dev/mmcblk0p1 -F</code>, <code>mount -o loop,rw /dev/mmcblk0p1 /tmp</code>, <code>touch /tmp/.developer_mode</code>, <code>unmount /tmp && sync</code>, <code>Reboot</code>.</li>
                <li>On "enrollment" branch shims, this script is already included within the new menu.</li>
            </details>
            <p>
            After enabling developer mode using either of the two methods above, you need to boot into the operating system, and run these last two following commands in the VT2 shell (by pressing Ctrl + Alt + F2 and entering `<code>root</code>`, these commands will <strong>NOT</strong> run in a shim.)
            <p>
            Quickly after you boot, run these commands: <code>vpd -i RW_VPD -s check_enrollment=0</code>, <code>cryptohome --action=remove_firmware_management_parameters</code>.
            <p>
            If you do not get the timing right, powerwash the Chromebook and try again. If you got the timing and everything else correct, you are done! Just exit the VT2 bash shell by pressing Ctrl + Alt + F1 and then follow the on-screen instructions to add your personal and school account on the unenrolled device. After all of that is done, you can now enjoy doing whatever you want on that unenrolled Chromebook!
            <p>
            <strong>EXTRA NOTE:</strong> Here is the decryption password to decrypt <code>cryptosmite_sh1mmer</code> or the encrypted version of CryptoSmite with SH1MMER: <code>Info-58-immense!NickName_Arabia-710</code>. If you want prebuilt shims that automatically go into CryptoSmite, go visit <a href="dl.darkn.bio" target="_blank">dl.darkn.bio</a>.
        </ol>
        </div>
    </body>
</html>
